# Braille O.C.R.

## Глобальная постановка задачи

Необходимо найти на фотографии шеститочечные символы Брайля, распознать и сложить в строки.
Точки однотипные и задача кажется несложной, но нужно помнить, что они (а) белые и (б) могут находиться на обеих сторонах листа, поэтому о наличии точки можно судить главным образом по тени, а тень при разном освещении может быть разная.

Подробнее: [дорожная карта проекта образца февраля 2021 г.](https://github.com/braille-systems/brl_ocr/wiki/roadmap-feb2021-ru#%D0%A0%D0%B0%D1%81%D0%BF%D0%BE%D0%B7%D0%BD%D0%B0%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%B8%D0%BC%D0%B2%D0%BE%D0%BB%D0%BE%D0%B2-%D0%91%D1%80%D0%B0%D0%B9%D0%BB%D1%8F-%D0%BD%D0%B0-%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F%D1%85)

## Что имеем

### Источники

Литературы сравнительно не очень много, потому что тема специфическая.
Многие статьи либо устарели, либо какие-то странные (например, решают очень упрощённую задачу).
Но есть и интересные, в т.ч. в последний год.

Обзоры статей и других источников: 

[Ильи Оводова](https://csspbstu-my.sharepoint.com/:u:/g/personal/zuev_va_edu_spbstu_ru/EX0zt2hbbIRFmEjgT4AvBYIBbo8HsrVoeX9CSX0nOuIzQA?e=PfraaA)
, [мой раз](https://github.com/braille-systems/brl_ocr/wiki#links)
и [мой два](https://github.com/braille-systems/brl_ocr/blob/main/doc/review.md).

[интересные статьи в PDF - диск](https://csspbstu-my.sharepoint.com/:f:/g/personal/zuev_va_edu_spbstu_ru/EvGTGMWbVZBBtG9I33OE1KwBnijAX72wY7uWccVvYMWXgQ?e=gGRDq8)
(там в т.ч. несколько статей не по Брайлю, а по постобработке распознанного текста).

Проблему определения точек на лицевой и оборотной сторонах листа пытались решать, например, установив две вспышки с разных сторон листа, делая фото сначала с одной, а затем с другой вспышкой.
У Ильи Оводова, программу которого я использую в своей работе, просто вводится ограничение на положение источника света (всегда спереди и сверху от листа).
Похожая схема у Баумгартнера (статьи Оводова и Баумгартнера среди PDF на диске, ссылка выше).

### Наработки Ильи Оводова

Илья Геннадиевич Оводов - программист из Зеленограда, который создал программу распознавания (http://angelina-reader.ru/) в помощь преподавательнице своей незрячей дочки.
Сначала он обучил нейронную сеть (RetinaNet) на китайском датасете DSBI, потом использовал её для полуавтоматической разметки детских стишков на русском (символы Брайля на разных языках, конечно же, одни и те же, всего 64 комбинации).
Почему стишки? Удобно проверять: он, как я понял, написал себе утилиту для разметки, которая подсвечивала распознанную нейросетью строку, если её нет в исходном стихе, т.е. есть ошибка. Разбивка прозы по строкам сложнее.

Обучив на стишках, Илья продолжил итерации обучения и разметки на других данных. В итоге получилась программа и датасет, которые он выложил в GitHub (см. его две статьи, ссылки выше).
У этой программы есть как минимум один аналог (Li et al, см. статьи в PDF), но программы нет в открытом доступе, так что ничего сказать про качество работы не могу.

Мы немного переписывались с Ильёй, он прислал библиографию и даже давал советы по поводу моих 
[старых планов](https://github.com/braille-systems/brl_ocr/wiki/roadmap-march2021-ru#%D0%9F%D1%80%D0%B5%D0%B4%D0%BB%D0%B0%D0%B3%D0%B0%D0%B5%D0%BC%D1%8B%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F)
, если будет интересно, конечно же, расскажу об этом подробнее.

### Мои наработки

Конечно же, Ангелина - очень хорошая программа, и я, не став изобретать велосипед, попытался её улучшить.
Далеко не всё получилось.

Самое главное, что достигнуто:

1. Собран [датасет](https://www.kaggle.com/valeryzuev/unlabeled-braille-photos) неразмеченных английских брайлевских страниц (книги Jane Eyre и Scarlett Letter)
1. На этих картинках запущена программа Ильи Оводова, т.о. получены *псевдометки*
1. Распознанный текст *выровнен* на исходный текст произведений, т.о. удалось понять, в каких местах и какие ошибки делает программа
1. Вычислены статистики ошибок (например, частоты замен одного символа на другой)
1. По полученным частотам построена примитивная программа постобработки текста, распознанного AngelinaReader: если распознанное слово отсутствует в словаре, подбирается наиболее вероятный (с учётом статистики замен) кандидат из словаря.

Написанные скрипты лежат [здесь (ветка develop)](https://github.com/braille-systems/brl_data_tools/tree/develop).
Кажется, инструкция в README рабочая.

Можно почитать
[мой диплом](https://csspbstu-my.sharepoint.com/:b:/g/personal/zuev_va_edu_spbstu_ru/ETSL3L7FtbFLtG9nw8U9JncBlgFGFANHHPhkY1wWBCPofA?e=wtGl9P)
, но там чуть-чуть устаревшая информация: например, я всё же не увеличиваю штраф за выпадение в два раза в алгоритме Нидлмана-Вунша - на практике оказывается, что это приводит к худшим результатам по сравнению с симметричными штрафами.
Ничего не сказано про постобработку, а результаты полуконтролируемого обучения с исправленными метками, честно говоря, интерпретированы чересчур радужно (на самом деле оно, как мне кажется, почти не работает, а приведённые в табл. 4.1 цифры мало о чём говорят, ибо обучение длилось 300 итераций, в то время как в реальности для получения рабочей программы Илья делал более 2000).
Лучше даже просто посмотреть [слайды презентации к диплому](https://csspbstu-my.sharepoint.com/:p:/g/personal/zuev_va_edu_spbstu_ru/EW4sShiVpJBMiCAE4GHY_nUBASA83wvmGgePq9nYXLf-2g?e=V6IrG5),
они новее.

## Что ещё можно сделать

Программа постобработки текста очень примитивная.
Нужно бы написать нормальную; я собираюсь этим заниматься и потом попробую опубликовать статью.
Впрочем, это не CV, а NLP (natural language processing).

Можно попробовать ещё какие-то старые или новые идеи по улучшению Ангелины методами CV и/или NLP - например, Илья положительно оценил мою (точнее, Андрея Стояна) идею добавить больше аугментаций (я что-то пытался сделать, но пока не очень заработало).

Можно попытаться научиться распознавать что-то ещё (например, таблички с надписями по Брайлю).
У меня даже есть небольшой (и неразмеченный) датасет.

Наконец, Ангелина плохо распознаёт математические, химические, нотные и т.п. символы, но что с этим делать, пока не очень понятно: там короткие "слова", в которых легко ошибиться, и не всегда разумно искать похожие в словаре, как в литературном тексте.

# Оптическое распознавание привычного текста

Этим я не занимался - ни разработкой программ, ни изучением проблемы.
Задача пока сформулирована в виде запроса от пользователя.

Мне казалось, что OCR - давно решённая проблема и распознавание текста должно работать "как часы".
Но недавно позвонила Виктория Николаевна (педагог из Центра медико-социальной реабилитации инвалидов по зрению, с которым мы сотрудничаем) и пожаловалась: она впервые захотела что-то распознать (квитанцию), скачала по рекомендации приложение EnvisionAI и оно плохое, не читает почти ничего.
Я указал ВН на то, что в Google Play >200 приложений с распознаванием и вряд ли можно придумать что-то новое.
Впрочем, EnvisionAI считается одним из лучших для незрячих; я его скачал и впрямь увидел, что текст, который человек на фото прочтёт без труда, читается плохо и с ошибками, т.е. не знаю, насколько легко сделать распознавание лучше (наверное, нелегко), но расти есть куда.
(отмечу, я пользуюсь распознаванием текста в Adobe Acrobat, и оно тоже работает с серьёзными ошибками - а, казалось бы, фирма с большим бюджетом).

Ещё одна проблема - незрячий не видит, под каким углом держать камеру и какое нужно освещение, есть ли блики, заслоняет ли что-то обзор.
Есть, кстати, специальное приложение, где волонтёры по видеосвязи помогают незрячим что-то прочесть или найти - они, конечно, могут попросить подвинуть камеру, включить свет и т.д.

Полагаю, здесь первое, что нужно сделать - опросить других пользователей (контакты есть), как они пользуются распознаванием и насколько довольны.
Из возникших идей - сделать программу с распознаванием, которая, в случае плохих условий съёмки, будет, как волонтёр, подсказывать незрячему, что сделать для получения качественного снимка (пока не искал аналоги).
